# lottery
## 射雕英雄传手游庆功宴抽奖

***
## 原理解密
### 本抽奖系统为什么安全
首先，抽奖机制的逻辑是单独处理的，无论其它模块发生了什么（即使出错），抽奖机制本身不受影响。

抽奖机制主要由两部分组成，一是 `乱序重排（reorder）` ，二是 `随机取样（sample）` 。另外有一个作为辅助的 `计时器（timer）`。

乱序重排：
    这部分根据一个随机生成的，极为复杂的种子，对原参与者名单进行乱序。这个种子长度为256，不可读，无语义，每次打开本系统都会变化。
    假定有两份该系统副本，同时在同一刻打开，这个种子也不相同，这保证了名单排序的不可预测。

随机取样：
    这部分上文乱序后名单的基础上，以时间戳为随机种子，进行随机抽选，直到满足名额或没有剩余未中奖者。
    假定有一套该系统副本，在两个不同的时刻分别抽奖，由于时间戳不同，取样结果不同，这保证了抽奖结果的不可预测。
    而取样结果，也就是中奖者名单，将从参与者名单中划除。这保证了，同一线上系统，同一套抽奖中，不会出现重复中奖者。

乱序重排与随机取样，从随机概率的角度是冗余的，两次随机没有意义：
    但由于乱序重排可以由系统伪造（比如我把种子写死在代码里），但随机取样的时间戳现场才知道，喊停者能决定，而大家都能见证，所以保证了结果的公平。
    同样，随机取样时间戳，喊停者可以决定，但由于乱序重排的种子完全随机，时间不相干，不可读不可记忆，所以任然保证了结果的公平。

计时器：
    计时器作为抽奖的辅助模块，由滚筒与抽奖结果面板共享。抽奖时，滚筒时间驱动，抽奖结果也时间驱动，这保证了喊停时，滚筒状态与抽奖结果完全一致。
    并且这个结果不是从滚筒复制，而是由滚筒模块和结果模块同时计算得出，二者必定一致但又相互印证。

最后，根据本次现场抽奖出现的情况，我解释下抽奖中的其它细节：
    首先，对于这次出现的，某轮抽奖结果由于操作员手误而导致无效的情况，这轮抽奖被系统视为无效，因而会放回未中奖名单，不影响后续继续中奖概率。
    并且，由于抽奖结果时间驱动，而不是时间间隔更换，对于一个不可预知但一定在将来确定的喊停时刻，中间无效操作不会对结果的公平产生影响。


### 抽奖结果为什么可验证且不可伪造


***
## 配置
### 参考 `配置` 目录下， [射雕英雄传的配置](./配置/射雕英雄传庆功宴.js)

***
## 需求
### 抽取人数少但名称较长
由于宽度超过而纵向排列，会出现滚动条，应该去掉

### 抽取人数过多时
这个滚动条可以设置成自动滚屏吗
人工去下拉有点low


### 特殊抽奖回合
@陈正 我们在对需求的时候发现一个问题，原定五等奖是抽奖箱抽，现在池总来发这个阳光普照奖，这个奖是人均一份，按照现在的抽奖逻辑抽取之后的就不会在下个阶段的奖项里面出现了，但是后面的非阳光普照奖还是需要他们可以继续参与，有没有办法来平衡这种现象
> 我整理一下啊，第一段是说，需求某个特定的回合，其中抽奖来源名单为全体而不是去掉幸运儿后的。并且抽奖结果也不作为幸运儿从名单中去除，也就是以后还参与其它轮抽奖，对吗？

阳光普照奖是京东卡，面值也不一样 50元的100张  100元50张  200元10张 500元10张 200元是20张

> ok，那么最后整理一下，新需求是：
打包两套抽奖系统，一个是 `庆功宴抽奖`，176人，一个是 `阳光普照` ，176-20人，
阳光普照共4轮，分别是 50元 100人， 100元 50 人， 200 元 20人 500 元 10人
这样？

> 奖品=人数=156   50元100张 100元 30张  200元 20张  500元6张


### 抽中的人没来的处理
点击名称替换


### 按键绑定
空格 -> start&stop
左右箭头 -> 上下轮
回车 -> 保存


### 预期效果
噗 类似这样 的意思

![预期效果](./.request/预期效果.png)

可以放游戏主宣图

### 时间估算
这周吧？下周一测试可以用就行


### 其它要求
然后希望是可以编辑的

后面可以拿这个套用别的 

比如换个素材 换个人员池子的


***
## 高级配置
### 美术资源（./static/image）

|路径|描述|
|--|--|
|bgi.jpg|背景图|
|pendant/cg.png|主宣图|
|pendant/logo.png|logo|
|pendant/恭喜中奖.png| `恭喜中奖` 字样|
> 以上只是几个例子，具体怎么摆放摆哪些挂件(pendant) 可以自定义和扩展

### 数据与流程配置

[抽奖回合](./../static/script/config.es6#73)

[数据集](./../static/script/config.es6#80)


### 界面样式配置
[挂件](./../static/script/config.es6#13)

[控制器](./../static/script/config.es6#43)

[抽奖台](./../static/script/config.es6#51)

[滚筒区域](./../static/script/config.es6#62)
